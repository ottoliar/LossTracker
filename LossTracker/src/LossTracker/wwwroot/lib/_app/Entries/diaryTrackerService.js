!function(){"use strict";var n=function(n,e){function r(n,e,r){if(r===!0)for(var t in v)v[t]+=n[t]*e;else for(var t in v)v[t]-=n[t]*e}function t(n,e,r){for(var t=0;t<n.length;t++){var a=n[t];if(a.id===e.id)return r&&n.splice(t,1),!0}return!1}function a(n,e,a){var i=n.food,o=n.numberOfServings;switch(n.mealId){case 1:t(d,n,e)||(d.push(n),r(i,o,a));break;case 2:t(p,n,e)||(p.push(n),r(i,o,a));break;case 3:t(l,n,e)||(l.push(n),r(i,o,a));break;case 4:t(g,n,e)||(g.push(n),r(i,o,a));break;case 5:t(g,n,e)||(g.push(n),r(i,o,a))}}var i=e("date")(new Date,"MM-dd-yyyy"),o="/api/foods/",s="/api/entries/"+i,u="/api/entries/edit/",f="/api/entries/delete/",c="/api/entries/getentry/",d=[],p=[],l=[],g=[],v={calories:0,carbGrams:0,proteinGrams:0,fatGrams:0},h=function(){return n.get(s).then(function(n){angular.forEach(n.data,function(n){a(n,!1,!0)})})},y=function(e){var r=c+e;return n.get(r).then(function(n){return n.data})},b=function(e,r,t){var i={FoodId:e,NumberOfServings:r,MealId:t};return n.post(s,JSON.stringify(i)).then(function(n){var e=n.data;a(e,!1,!0)})},m=function(e,t,a){var i=e.food,o=e.foodId,s=e.mealId,f={mealId:s,numberOfServings:a,FoodId:o},c=u+e.id;return n.post(c,JSON.stringify(f),{headers:{"Content-Type":"application/json"}}).then(function(n){function o(n,e){for(var r=0;r<n.length;r++){var t=n[r];if(t.id===e.id)return void(t.numberOfServings=a)}}switch(t>a?r(i,t-a,!1):a>t&&r(i,a-t,!0),s){case 1:o(d,e);break;case 2:o(p,e);break;case 3:o(l,e);break;case 4:o(g,e);break;default:o(g,e)}})},k=function(e,r){return null==r?n.post(o,JSON.stringify(e),{headers:{"Content-Type":"application/json"}}):n.post(o,JSON.stringify(e),{headers:{"Content-Type":"application/json"}}).then(function(n){var e=n.data,t=r.servings;"breakfast"===r.meal?b(e,t,1):"lunch"===r.meal?b(e,t,2):"dinner"===r.meal?b(e,t,3):b(e,t,4)})},S=function(e){var t=e.numberOfServings,i=e.food,o=f+e.id;return n.post(o).then(function(n){a(e,!0,!1),r(i,t,!1)})},E=function(){return v},O=function(){return d},I=function(){return p},D=function(){return l},N=function(){return g};return{getBreakfastEntries:O,getLunchEntries:I,getDinnerEntries:D,getSnackEntries:N,addDiaryEntry:b,createFood:k,getSingleEntry:y,getLatestDiaryMacros:E,getEntriesForToday:h,editEntry:m,deleteEntry:S}};n.$inject=["$http","$filter"];var e=angular.module("appDiary");e.factory("diaryTracker",n)}();